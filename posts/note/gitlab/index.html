<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>GitLab CI å…¥é—¨ | Javen&#39;s Blog</title>
<meta name="keywords" content="CICD">
<meta name="description" content="GitLabå…¥é—¨">
<meta name="author" content="Javen">
<link rel="canonical" href="https://jary-287.github.io/cloudnative.github.io/posts/note/gitlab/">
<link crossorigin="anonymous" href="/cloudnative.github.io/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/cloudnative.github.io/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://jary-287.github.io/cloudnative.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://jary-287.github.io/cloudnative.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://jary-287.github.io/cloudnative.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://jary-287.github.io/cloudnative.github.io/Q.gif">
<link rel="mask-icon" href="https://jary-287.github.io/cloudnative.github.io/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="GitLab CI å…¥é—¨" />
<meta property="og:description" content="GitLabå…¥é—¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jary-287.github.io/cloudnative.github.io/posts/note/gitlab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-01T15:53:53+08:00" />
<meta property="article:modified_time" content="2023-05-01T15:53:53+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GitLab CI å…¥é—¨"/>
<meta name="twitter:description" content="GitLabå…¥é—¨"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æ‰€æœ‰å†…å®¹",
      "item": "https://jary-287.github.io/cloudnative.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ“•ç¬”è®°",
      "item": "https://jary-287.github.io/cloudnative.github.io/posts/note/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "GitLab CI å…¥é—¨",
      "item": "https://jary-287.github.io/cloudnative.github.io/posts/note/gitlab/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "GitLab CI å…¥é—¨",
  "name": "GitLab CI å…¥é—¨",
  "description": "GitLabå…¥é—¨",
  "keywords": [
    "CICD"
  ],
  "articleBody": " GitLab CI å…¥é—¨ ä¸€ã€æ¦‚è¿° 1.ç»„ä»¶ gitlab CI/CD gitlabçš„åŠŸèƒ½ gitlab Runner gitlab CICDçš„æ‰§è¡Œè€… .gitlab-ci.yml æµæ°´çº¿æè¿°æ–‡ä»¶ï¼Œæè¿°æµæ°´çº¿æ‰§è¡Œçš„æ­¥éª¤ 2.å·¥ä½œæµç¨‹ å°†ä»£ç æäº¤åˆ°gitå­˜å‚¨åº“\nåœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºciæ–‡ä»¶.gitlab-ci.yml,å¹¶åœ¨æ–‡ä»¶ä¸­æŒ‡å®šå„é˜¶æ®µæ“ä½œ\ngitlabç›‘æµ‹åˆ°è¯¥æ–‡ä»¶å¹¶ä½¿ç”¨gitlab runnerè¿è¡Œè„šæœ¬\nè„šæœ¬è¢«åˆ†ç»„æˆä¸ºä½œä¸šï¼Œå…±åŒæ„æˆäº†ä¸€ä¸ªç®¡é“\n3.jenkins VS gitlab CI jenkins ç¼–è¯‘æœåŠ¡ä¸ä»£ç åº“åˆ†ç¦»ï¼Œè€¦åˆåº¦ä½ æ’ä»¶ä¸°å¯Œï¼Œæ”¯æŒè¯­è¨€å¤šï¼Œä½†æ’ä»¶ç»´æŠ¤éš¾ ç»Ÿä¸€çš„webç•Œé¢ ä½“é‡å¤§ æƒé™ç®¡ç†éš¾ gitlab CI è½»é‡çº§ï¼Œä¸éœ€è¦å¤æ‚çš„å®‰è£…æ‰‹æ®µ é…ç½®ç®€å• å®æ—¶æ„å»ºæ—¥å¿—æ¸…æ™° æ²¡æœ‰ç»Ÿä¸€ç®¡ç†ç•Œé¢ é…ç½®ä¾èµ–ä»£ç åº“ï¼Œè€¦åˆåº¦é«˜ æƒé™ç®¡ç†æ–¹ä¾¿ äºŒã€gitlab å®‰è£… 1.gitlab 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # ä½¿ç”¨æ¸…åæºå®‰è£…https://mirrors.tuna.tsinghua.edu.cn/help/gitlab-ce/ï¼Œä¸ç„¶ä¸‹è½½åˆ°æ­» # curl https://packages.gitlab.com/gpg.key 2\u003e /dev/null | sudo apt-key add - \u0026\u003e/dev/null # æ·»åŠ é•œåƒä»“åº“ echo deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu focal main \u003e\u003e /etc/apt/sources.list.d/gitlab-ce.list # æ›´æ–°å¹¶å®‰è£… ljw@server:~$ sudo apt-get update ljw@server:~$ sudo apt-get install gitlab-ce # ä¿®æ”¹é…ç½®æ–‡ä»¶ ljw@server:~$ sudo cat /etc/gitlab/gitlab.rb | grep external_url | grep -v ^# external_url 'http://mygitlab.com' # åŸŸåè®¿é—® # é‡æ–°é…ç½®å¹¶å¯åŠ¨ ljw@server:~$ sudo gitlab-ctl reconfigure ljw@server:~$ sudo gitlab-ctl start # æŸ¥çœ‹é»˜è®¤å¯†ç ç„¶åç™»é™† ljw@server:~$ sudo cat /etc/gitlab/initial_root_password # WARNING: This value is valid only in the following conditions # 1. If provided manually (either via `GITLAB_ROOT_PASSWORD` environment variable or via `gitlab_rails['initial_root_password']` setting in `gitlab.rb`, it was provided before database was seeded for the first time (usually, the first reconfigure run). # 2. Password hasn't been changed manually, either via UI or via command line. # # If the password shown here doesn't work, you must reset the admin password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password. Password: Kkg82QhvKwvDbjTZ9ElwN7nuxe/MeNCkfG2V54weyaM= # NOTE: This file will be automatically deleted in the first reconfigure run after 24 hours. ä¸‰ã€runner 1.ä»€ä¹ˆæ˜¯runner runneræ˜¯goè¯­è¨€ç¼–å†™çš„è·¨å¹³å°çš„gitlabæ‰§è¡Œä½œä¸šçš„agentï¼Œç”¨äºæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ä¸­çš„è„šæœ¬ä»»åŠ¡ 2.ç‰¹ç‚¹ åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸š åœ¨æœ¬åœ°/docker/k8sæ‰§è¡Œ è¿æ¥åˆ°è¿œç¨‹sshæœåŠ¡å™¨ è‡ªåŠ¨åŠ è½½ å…è®¸è‡ªå®šä¹‰ä½œä¸šç¯å¢ƒ 3.ç±»å‹/çŠ¶æ€ ç±»å‹ sheardå…±äº«ç±»å‹ï¼Œå…¨éƒ¨å¯ç”¨ groupé¡¹ç›®ç»„ç±»å‹ specificç‰¹å®šé¡¹ç›®ç±»å‹ï¼Œå½“å‰é¡¹ç›®å¯ç”¨ çŠ¶æ€ lockedï¼šé”å®šçŠ¶æ€ï¼Œæ— æ³•è¿è¡Œä½œä¸š paused ï¼šæš‚åœçŠ¶æ€ï¼Œä¸ä¼šæ¥å—æ–°çš„ä½œä¸š 4.å®‰è£… ubuntuå®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # gitlab runnerç®¡ç†ç•Œé¢å±•ç¤ºäº†å®‰è£…æ–¹æ³•ï¼Œç…§åšå³å¯ # Download the binary for your system sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64 # Give it permission to execute sudo chmod +x /usr/local/bin/gitlab-runner # Create a GitLab Runner user sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash # Install and run as a service sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner sudo gitlab-runner start # æ³¨å†Œ sudo gitlab-runner register --url http://mygitlab.com/ --registration-token M1jkqBfpuuzAnH9s7aYE # åˆ é™¤ ljw@server:/etc$ sudo gitlab-runner verify --delete -t 7cEPwExkwMdD5_bU7ECh -u http://mygitlab.com/ # æ³¨å†Œç›¸åŒ,æ³¨å†Œä¸€ä¸ªsharedç±»å‹çš„runner ERRO[0000] Docker executor: prebuilt image helpers will be loaded from /var/lib/gitlab-runner. Running in system-mode. Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/): [http://mygitlab.com/]: Please enter the gitlab-ci token for this runner: [M1jkqBfpuuzAnH9s7aYE]: Please enter the gitlab-ci description for this runner: [server]: Please enter the gitlab-ci tags for this runner (comma separated): implement Registering runner... succeeded runner=M1jkqBfp Please enter the executor: ssh, virtualbox, docker+machine, docker-ssh+machine, docker-ssh, parallels, kubernetes, docker, shell: shell Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded! dockerå®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # åˆ›å»ºé…ç½®æ–‡ä»¶æŒ‚åœ¨ç›®å½• ljw@server:~$ mkdir gitlab_runner_config # å¯åŠ¨å®¹å™¨ ljw@server:~$ sudo docker run -d --name gitlab-runner --restart always -v /var/run/docker.so^C:/var/run/docker.sock -v /home/ljw/gitlab_runner_config/:/etc/gitlab-runner gitlab/gitlab-runner:latest [sudo] password for ljw: Unable to find image 'gitlab/gitlab-runner:latest' locally latest: Pulling from gitlab/gitlab-runner 846c0b181fff: Pull complete f05423af2dfd: Pull complete d92eb7aeb475: Pull complete Digest: sha256:15a3945030802e20d24326aef1e60b69478336842db88069303ddfdfe9cebf9a Status: Downloaded newer image for gitlab/gitlab-runner:latest 6125256c41ce4dc86f54aac997b50a633b94a0c94209740a3dc3be9e4e0983b7 ljw@server:~$ sudo docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 6125256c41ce gitlab/gitlab-runner:latest \"/usr/bin/dumb-init â€¦\" 19 seconds ago Up 17 seconds gitlab-runner # æ–°å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œtest # ç•¥ # æ³¨å†Œä¸€ä¸ªç‰¹å®šé¡¹ç›®runnerï¼Œä¸ºtest,ç¡®ä¿å®¹å™¨èƒ½è§£æåˆ°mygitlab.com ljw@server:~$ sudo docker exec -it gitlab-runner /bin/bash root@6125256c41ce:/# gitlab-runner register --url http://mygitlab.com/ --registration-token GR1348941sgKMG1cURqipSf8s7u7M Runtime platform arch=amd64 os=linux pid=56 revision=6d480948 version=15.7.1 Running in system-mode. Enter the GitLab instance URL (for example, https://gitlab.com/): [http://mygitlab.com/]: Enter the registration token: [GR1348941sgKMG1cURqipSf8s7u7M]: Enter a description for the runner: [6125256c41ce]: Enter tags for the runner (comma-separated): Enter optional maintenance note for the runner: WARNING: Support for registration tokens and runner parameters in the 'register' command has been deprecated in GitLab Runner 15.6 and will be replaced with support for authentication tokens. For more information, see https://gitlab.com/gitlab-org/gitlab/-/issues/380872 Registering runner... succeeded runner=GR1348941sgKMG1cU Enter an executor: kubernetes, custom, docker, parallels, shell, ssh, docker+machine, instance, docker-ssh, virtualbox, docker-ssh+machine: shell Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded! Configuration (with the authentication token) was saved in \"/etc/gitlab-runner/config.toml\" å››ã€CICDæµæ°´çº¿ 1.åŸºæœ¬ä½¿ç”¨ åˆ›å»ºé¡¹ç›®test â€‹\té¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºæµæ°´çº¿æ–‡ä»¶.gitlab-ci.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 stages: # List of stages for jobs, and their order of execution - build - test - deploy build-job: # This job runs in the build stage, which runs first. stage: build script: - echo \"Compiling the code...\" - echo \"Compile complete.\" unit-test-job: # This job runs in the test stage. stage: test # It only starts when the job in the build stage completes successfully. script: - echo \"Running unit tests... This will take about 60 seconds.\" - sleep 5 - echo \"Code coverage is 90%\" lint-test-job: # This job also runs in the test stage. stage: test # It can run at the same time as unit-test-job (in parallel). script: - echo \"Linting code... This will take about 10 seconds.\" - sleep 10 - echo \"No lint issues found.\" deploy-job: # This job runs in the deploy stage. stage: deploy # It only runs when *both* jobs in the test stage complete successfully. environment: production script: - echo \"Deploying application...\" - echo \"Application successfully deployed.\" æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½ä¼šè§¦å‘æµæ°´çº¿\nå¯ç‚¹å‡»æŸä¸€æ¬¡æµæ°´çº¿æŸ¥çœ‹æ‰§è¡Œè¯¦æƒ…\npipelineæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸‰ä¸ªé˜¶æ®µï¼Œbuildï¼Œtestï¼Œdeployï¼Œå¯åˆ†åˆ«æŸ¥çœ‹\nâ€‹\t2.æµæ°´çº¿è¯­æ³•æ£€æµ‹ ä½¿ç”¨CI lint æ£€æŸ¥pipelineæ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œç„¶åå†ä¿®æ”¹ä»“åº“æ–‡ä»¶ 3.pipelineè¯­æ³• å…³é”®å­—æ¦‚è§ˆ å…³é”®è¯ ä½œç”¨ job pipelineæ–‡ä»¶ä¸­ç”±å¤šä¸ªä½œä¸šç»„æˆï¼Œæ¯ä¸ªä½œä¸šå¿…é¡»æœ‰ä¸€ä¸ªscriptï¼Œåå­—å¿…é¡»å”¯ä¸€ script æŒ‡å®šå…·ä½“çš„æ“ä½œï¼Œç°åœ¨æ˜¯shellè¯­å¥ before_script ä½œä¸šè¿è¡Œä¹‹å‰è¦åšçš„æ“ä½œï¼Œå¦‚æœæ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªä½œä¸šéƒ½ä¼šæ‰§è¡Œ after_script ä½œä¸šè¿è¡Œä¹‹åè¦åšçš„æ“ä½œï¼Œå¦‚æœæ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªä½œä¸šéƒ½ä¼šæ‰§è¡Œ stages æ§åˆ¶stageçš„é¡ºåºï¼Œä¸€ä¸ªstageå¯èƒ½æ‰§è¡Œå¤šä¸ªä½œä¸š stage æŒ‡å®šå½“å‰æ˜¯å“ªä¸ªstageï¼Œä¸¤ä¸ªå…³é”®å­—ï¼š.preä¸ºç¬¬ä¸€ä¸ªè¿è¡Œï¼Œ.postä¸ºæœ€åè¿è¡Œ variables å®šä¹‰å˜é‡ tags æŒ‡å®šrunner allow_failure å…è®¸å¤±è´¥ï¼Œé»˜è®¤å€¼ä¸ºfalse when æ§åˆ¶ä½œä¸šæ‰§è¡Œæ¡ä»¶ retry é‡è¯•æ¬¡æ•° timeout è¶…æ—¶æ—¶é—´ parallel å¹¶è¡Œä½œä¸šå®ä¾‹æ•°ï¼Œ2",
  "wordCount" : "8009",
  "inLanguage": "en",
  "datePublished": "2023-05-01T15:53:53+08:00",
  "dateModified": "2023-05-01T15:53:53+08:00",
  "author":[{
    "@type": "Person",
    "name": "Javen"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jary-287.github.io/cloudnative.github.io/posts/note/gitlab/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Javen's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jary-287.github.io/cloudnative.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jary-287.github.io/cloudnative.github.io" accesskey="h" title="Javen&#39;s Blog (Alt + H)">
                <img src="https://www.sulvblog.cn/Q.gif" alt="" aria-label="logo"
                    height="35">Javen&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://jary-287.github.io/cloudnative.github.io/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jary-287.github.io/cloudnative.github.io">Home</a>&nbsp;Â»&nbsp;<a href="https://jary-287.github.io/cloudnative.github.io/posts/">æ‰€æœ‰å†…å®¹</a>&nbsp;Â»&nbsp;<a href="https://jary-287.github.io/cloudnative.github.io/posts/note/">ğŸ“•ç¬”è®°</a></div>
    <h1 class="post-title">
      GitLab CI å…¥é—¨
    </h1>
    <div class="post-description">
      GitLabå…¥é—¨
    </div>
    <div class="post-meta"><span title='2023-05-01 15:53:53 +0800 CST'>2023-05-01</span>&nbsp;Â·&nbsp;16 min&nbsp;Â·&nbsp;Javen

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#gitlab-ci-%e5%85%a5%e9%97%a8" aria-label="GitLab CI å…¥é—¨">GitLab CI å…¥é—¨</a><ul>
                            
                    <li>
                        <a href="#%e4%b8%80%e6%a6%82%e8%bf%b0" aria-label="ä¸€ã€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°</a><ul>
                            
                    <li>
                        <a href="#1%e7%bb%84%e4%bb%b6" aria-label="1.ç»„ä»¶">1.ç»„ä»¶</a><ul>
                            
                    <li>
                        <a href="#gitlab-cicd" aria-label="gitlab CI/CD">gitlab CI/CD</a></li>
                    <li>
                        <a href="#gitlab-runner" aria-label="gitlab Runner">gitlab Runner</a></li>
                    <li>
                        <a href="#gitlab-ciyml" aria-label=".gitlab-ci.yml">.gitlab-ci.yml</a></li></ul>
                    </li>
                    <li>
                        <a href="#2%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" aria-label="2.å·¥ä½œæµç¨‹">2.å·¥ä½œæµç¨‹</a></li>
                    <li>
                        <a href="#3jenkins-vs-gitlab-ci" aria-label="3.jenkins VS gitlab CI">3.jenkins VS gitlab CI</a><ul>
                            
                    <li>
                        <a href="#jenkins" aria-label="jenkins">jenkins</a></li>
                    <li>
                        <a href="#gitlab-ci" aria-label="gitlab CI">gitlab CI</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e4%ba%8cgitlab-%e5%ae%89%e8%a3%85" aria-label="äºŒã€gitlab å®‰è£…">äºŒã€gitlab å®‰è£…</a><ul>
                            
                    <li>
                        <a href="#1gitlab" aria-label="1.gitlab">1.gitlab</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%89runner" aria-label="ä¸‰ã€runner">ä¸‰ã€runner</a><ul>
                            
                    <li>
                        <a href="#1%e4%bb%80%e4%b9%88%e6%98%afrunner" aria-label="1.ä»€ä¹ˆæ˜¯runner">1.ä»€ä¹ˆæ˜¯runner</a></li>
                    <li>
                        <a href="#2%e7%89%b9%e7%82%b9" aria-label="2.ç‰¹ç‚¹">2.ç‰¹ç‚¹</a></li>
                    <li>
                        <a href="#3%e7%b1%bb%e5%9e%8b%e7%8a%b6%e6%80%81" aria-label="3.ç±»å‹/çŠ¶æ€">3.ç±»å‹/çŠ¶æ€</a><ul>
                            
                    <li>
                        <a href="#%e7%b1%bb%e5%9e%8b" aria-label="ç±»å‹">ç±»å‹</a></li>
                    <li>
                        <a href="#%e7%8a%b6%e6%80%81" aria-label="çŠ¶æ€">çŠ¶æ€</a></li></ul>
                    </li>
                    <li>
                        <a href="#4%e5%ae%89%e8%a3%85" aria-label="4.å®‰è£…">4.å®‰è£…</a><ul>
                            
                    <li>
                        <a href="#ubuntu%e5%ae%89%e8%a3%85" aria-label="ubuntuå®‰è£…">ubuntuå®‰è£…</a></li>
                    <li>
                        <a href="#docker%e5%ae%89%e8%a3%85" aria-label="dockerå®‰è£…">dockerå®‰è£…</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e5%9b%9bcicd%e6%b5%81%e6%b0%b4%e7%ba%bf" aria-label="å››ã€CICDæµæ°´çº¿">å››ã€CICDæµæ°´çº¿</a><ul>
                            
                    <li>
                        <a href="#1%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8" aria-label="1.åŸºæœ¬ä½¿ç”¨">1.åŸºæœ¬ä½¿ç”¨</a></li>
                    <li>
                        <a href="#2%e6%b5%81%e6%b0%b4%e7%ba%bf%e8%af%ad%e6%b3%95%e6%a3%80%e6%b5%8b" aria-label="2.æµæ°´çº¿è¯­æ³•æ£€æµ‹">2.æµæ°´çº¿è¯­æ³•æ£€æµ‹</a></li>
                    <li>
                        <a href="#3pipeline%e8%af%ad%e6%b3%95" aria-label="3.pipelineè¯­æ³•">3.pipelineè¯­æ³•</a><ul>
                            
                    <li>
                        <a href="#%e5%85%b3%e9%94%ae%e5%ad%97%e6%a6%82%e8%a7%88" aria-label="å…³é”®å­—æ¦‚è§ˆ">å…³é”®å­—æ¦‚è§ˆ</a></li>
                    <li>
                        <a href="#%e5%9f%ba%e6%9c%ac%e5%85%b3%e9%94%ae%e5%ad%97%e4%bd%bf%e7%94%a8" aria-label="åŸºæœ¬å…³é”®å­—ä½¿ç”¨">åŸºæœ¬å…³é”®å­—ä½¿ç”¨</a></li>
                    <li>
                        <a href="#tagsallow_failurewhenretrytimeoutparallel" aria-label="tagsã€allow_failureã€whenã€retryã€timeoutã€parallel">tagsã€allow_failureã€whenã€retryã€timeoutã€parallel</a></li>
                    <li>
                        <a href="#onlyexceptrulesworkflow" aria-label="only,except,rules,workflow">only,except,rules,workflow</a></li>
                    <li>
                        <a href="#cacheartifactsdependencies" aria-label="cache,artifacts,dependencies">cache,artifacts,dependencies</a></li>
                    <li>
                        <a href="#needs" aria-label="needs">needs</a></li>
                    <li>
                        <a href="#imageservices" aria-label="image/services">image/services</a></li>
                    <li>
                        <a href="#environment" aria-label="environment">environment</a></li>
                    <li>
                        <a href="#inherit" aria-label="inherit">inherit</a></li></ul>
                    </li>
                    <li>
                        <a href="#4%e6%a8%a1%e7%89%88%e5%ba%93%e8%a7%84%e5%88%92" aria-label="4.æ¨¡ç‰ˆåº“è§„åˆ’">4.æ¨¡ç‰ˆåº“è§„åˆ’</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%ba%94%e5%b7%a5%e5%85%b7%e9%93%be%e7%bb%a7%e6%89%bf" aria-label="äº”ã€å·¥å…·é“¾ç»§æ‰¿">äº”ã€å·¥å…·é“¾ç»§æ‰¿</a><ul>
                            
                    <li>
                        <a href="#1maven%e9%9b%86%e6%88%90" aria-label="1.Mavené›†æˆ">1.Mavené›†æˆ</a></li>
                    <li>
                        <a href="#2npm%e9%9b%86%e6%88%90" aria-label="2.Npmé›†æˆ">2.Npmé›†æˆ</a></li>
                    <li>
                        <a href="#3%e9%9b%86%e6%88%90%e5%88%b6%e5%93%81%e5%ba%93" aria-label="3.é›†æˆåˆ¶å“åº“">3.é›†æˆåˆ¶å“åº“</a></li>
                    <li>
                        <a href="#4%e9%95%9c%e5%83%8f%e4%bb%93%e5%ba%93%e9%9b%86%e6%88%90" aria-label="4.é•œåƒä»“åº“é›†æˆ">4.é•œåƒä»“åº“é›†æˆ</a></li>
                    <li>
                        <a href="#5jmeter%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e9%9b%86%e6%88%90" aria-label="5.jmeterè‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ">5.jmeterè‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ</a></li>
                    <li>
                        <a href="#6sonarqube%e4%bb%a3%e7%a0%81%e6%89%ab%e6%8f%8f%e9%9b%86%e6%88%90" aria-label="6.SonarQubeä»£ç æ‰«æé›†æˆ">6.SonarQubeä»£ç æ‰«æé›†æˆ</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><hr>
<h1 id="gitlab-ci-å…¥é—¨">GitLab CI å…¥é—¨<a hidden class="anchor" aria-hidden="true" href="#gitlab-ci-å…¥é—¨">#</a></h1>
<h2 id="ä¸€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#ä¸€æ¦‚è¿°">#</a></h2>
<h3 id="1ç»„ä»¶">1.ç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#1ç»„ä»¶">#</a></h3>
<h4 id="gitlab-cicd">gitlab CI/CD<a hidden class="anchor" aria-hidden="true" href="#gitlab-cicd">#</a></h4>
<ul>
<li>gitlabçš„åŠŸèƒ½</li>
</ul>
<h4 id="gitlab-runner">gitlab Runner<a hidden class="anchor" aria-hidden="true" href="#gitlab-runner">#</a></h4>
<ul>
<li>gitlab CICDçš„æ‰§è¡Œè€…</li>
</ul>
<h4 id="gitlab-ciyml">.gitlab-ci.yml<a hidden class="anchor" aria-hidden="true" href="#gitlab-ciyml">#</a></h4>
<ul>
<li>æµæ°´çº¿æè¿°æ–‡ä»¶ï¼Œæè¿°æµæ°´çº¿æ‰§è¡Œçš„æ­¥éª¤</li>
</ul>
<h3 id="2å·¥ä½œæµç¨‹">2.å·¥ä½œæµç¨‹<a hidden class="anchor" aria-hidden="true" href="#2å·¥ä½œæµç¨‹">#</a></h3>
<ul>
<li>
<p>å°†ä»£ç æäº¤åˆ°gitå­˜å‚¨åº“</p>
</li>
<li>
<p>åœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºciæ–‡ä»¶.gitlab-ci.yml,å¹¶åœ¨æ–‡ä»¶ä¸­æŒ‡å®šå„é˜¶æ®µæ“ä½œ</p>
</li>
<li>
<p>gitlabç›‘æµ‹åˆ°è¯¥æ–‡ä»¶å¹¶ä½¿ç”¨gitlab runnerè¿è¡Œè„šæœ¬</p>
</li>
<li>
<p>è„šæœ¬è¢«åˆ†ç»„æˆä¸ºä½œä¸šï¼Œå…±åŒæ„æˆäº†ä¸€ä¸ªç®¡é“</p>
</li>
</ul>
<h3 id="3jenkins-vs-gitlab-ci">3.jenkins VS gitlab CI<a hidden class="anchor" aria-hidden="true" href="#3jenkins-vs-gitlab-ci">#</a></h3>
<h4 id="jenkins">jenkins<a hidden class="anchor" aria-hidden="true" href="#jenkins">#</a></h4>
<ul>
<li>ç¼–è¯‘æœåŠ¡ä¸ä»£ç åº“åˆ†ç¦»ï¼Œè€¦åˆåº¦ä½</li>
<li>æ’ä»¶ä¸°å¯Œï¼Œæ”¯æŒè¯­è¨€å¤šï¼Œä½†æ’ä»¶ç»´æŠ¤éš¾</li>
<li>ç»Ÿä¸€çš„webç•Œé¢</li>
<li>ä½“é‡å¤§</li>
<li>æƒé™ç®¡ç†éš¾</li>
</ul>
<h4 id="gitlab-ci">gitlab CI<a hidden class="anchor" aria-hidden="true" href="#gitlab-ci">#</a></h4>
<ul>
<li>è½»é‡çº§ï¼Œä¸éœ€è¦å¤æ‚çš„å®‰è£…æ‰‹æ®µ</li>
<li>é…ç½®ç®€å•</li>
<li>å®æ—¶æ„å»ºæ—¥å¿—æ¸…æ™°</li>
<li>æ²¡æœ‰ç»Ÿä¸€ç®¡ç†ç•Œé¢</li>
<li>é…ç½®ä¾èµ–ä»£ç åº“ï¼Œè€¦åˆåº¦é«˜</li>
<li>æƒé™ç®¡ç†æ–¹ä¾¿</li>
</ul>
<h2 id="äºŒgitlab-å®‰è£…">äºŒã€gitlab å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#äºŒgitlab-å®‰è£…">#</a></h2>
<h3 id="1gitlab">1.gitlab<a hidden class="anchor" aria-hidden="true" href="#1gitlab">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ä½¿ç”¨æ¸…åæºå®‰è£…https://mirrors.tuna.tsinghua.edu.cn/help/gitlab-ce/ï¼Œä¸ç„¶ä¸‹è½½åˆ°æ­»</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ·»åŠ é•œåƒä»“åº“</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu focal main &gt;&gt; /etc/apt/sources.list.d/gitlab-ce.list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ›´æ–°å¹¶å®‰è£…</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo apt-get update
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo apt-get install gitlab-ce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo cat /etc/gitlab/gitlab.rb | grep external_url | grep -v ^#
</span></span><span style="display:flex;"><span>external_url <span style="color:#0ff;font-weight:bold">&#39;http://mygitlab.com&#39;</span>  <span style="color:#007f7f"># åŸŸåè®¿é—®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é‡æ–°é…ç½®å¹¶å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo gitlab-ctl reconfigure
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo gitlab-ctl start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹é»˜è®¤å¯†ç ç„¶åç™»é™†</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo cat /etc/gitlab/initial_root_password
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># WARNING: This value is valid only in the following conditions</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#          1. If provided manually (either via `GITLAB_ROOT_PASSWORD` environment variable or via `gitlab_rails[&#39;initial_root_password&#39;]` setting in `gitlab.rb`, it was provided before database was seeded for the first time (usually, the first reconfigure run).</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#          2. Password hasn&#39;t been changed manually, either via UI or via command line.</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#          If the password shown here doesn&#39;t work, you must reset the admin password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Password: Kkg82QhvKwvDbjTZ9ElwN7nuxe/MeNCkfG2V54weyaM=
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># NOTE: This file will be automatically deleted in the first reconfigure run after 24 hours.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230109184709518.png" alt="image-20230109184709518"  />
</p>
<h2 id="ä¸‰runner">ä¸‰ã€runner<a hidden class="anchor" aria-hidden="true" href="#ä¸‰runner">#</a></h2>
<h3 id="1ä»€ä¹ˆæ˜¯runner">1.ä»€ä¹ˆæ˜¯runner<a hidden class="anchor" aria-hidden="true" href="#1ä»€ä¹ˆæ˜¯runner">#</a></h3>
<ul>
<li>runneræ˜¯goè¯­è¨€ç¼–å†™çš„è·¨å¹³å°çš„gitlabæ‰§è¡Œä½œä¸šçš„agentï¼Œç”¨äºæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ä¸­çš„è„šæœ¬ä»»åŠ¡</li>
</ul>
<h3 id="2ç‰¹ç‚¹">2.ç‰¹ç‚¹<a hidden class="anchor" aria-hidden="true" href="#2ç‰¹ç‚¹">#</a></h3>
<ul>
<li>åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸š</li>
<li>åœ¨æœ¬åœ°/docker/k8sæ‰§è¡Œ</li>
<li>è¿æ¥åˆ°è¿œç¨‹sshæœåŠ¡å™¨</li>
<li>è‡ªåŠ¨åŠ è½½</li>
<li>å…è®¸è‡ªå®šä¹‰ä½œä¸šç¯å¢ƒ</li>
</ul>
<h3 id="3ç±»å‹çŠ¶æ€">3.ç±»å‹/çŠ¶æ€<a hidden class="anchor" aria-hidden="true" href="#3ç±»å‹çŠ¶æ€">#</a></h3>
<h4 id="ç±»å‹">ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#ç±»å‹">#</a></h4>
<ul>
<li>sheardå…±äº«ç±»å‹ï¼Œå…¨éƒ¨å¯ç”¨</li>
<li>groupé¡¹ç›®ç»„ç±»å‹</li>
<li>specificç‰¹å®šé¡¹ç›®ç±»å‹ï¼Œå½“å‰é¡¹ç›®å¯ç”¨</li>
</ul>
<h4 id="çŠ¶æ€">çŠ¶æ€<a hidden class="anchor" aria-hidden="true" href="#çŠ¶æ€">#</a></h4>
<ul>
<li>lockedï¼šé”å®šçŠ¶æ€ï¼Œæ— æ³•è¿è¡Œä½œä¸š</li>
<li>paused ï¼šæš‚åœçŠ¶æ€ï¼Œä¸ä¼šæ¥å—æ–°çš„ä½œä¸š</li>
</ul>
<h3 id="4å®‰è£…">4.å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#4å®‰è£…">#</a></h3>
<h4 id="ubuntuå®‰è£…">ubuntuå®‰è£…<a hidden class="anchor" aria-hidden="true" href="#ubuntuå®‰è£…">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># gitlab runnerç®¡ç†ç•Œé¢å±•ç¤ºäº†å®‰è£…æ–¹æ³•ï¼Œç…§åšå³å¯</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Download the binary for your system</span>
</span></span><span style="display:flex;"><span>sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Give it permission to execute</span>
</span></span><span style="display:flex;"><span>sudo chmod +x /usr/local/bin/gitlab-runner
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Create a GitLab Runner user</span>
</span></span><span style="display:flex;"><span>sudo useradd --comment <span style="color:#0ff;font-weight:bold">&#39;GitLab Runner&#39;</span> --create-home gitlab-runner --shell /bin/bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Install and run as a service</span>
</span></span><span style="display:flex;"><span>sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
</span></span><span style="display:flex;"><span>sudo gitlab-runner start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ³¨å†Œ</span>
</span></span><span style="display:flex;"><span>sudo gitlab-runner register --url http://mygitlab.com/ --registration-token M1jkqBfpuuzAnH9s7aYE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤</span>
</span></span><span style="display:flex;"><span>ljw@server:/etc$ sudo gitlab-runner verify --delete -t 7cEPwExkwMdD5_bU7ECh -u http://mygitlab.com/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ³¨å†Œç›¸åŒ,æ³¨å†Œä¸€ä¸ªsharedç±»å‹çš„runner</span>
</span></span><span style="display:flex;"><span>ERRO[0000] Docker executor: prebuilt image helpers will be loaded from /var/lib/gitlab-runner.
</span></span><span style="display:flex;"><span>Running in system-mode.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):
</span></span><span style="display:flex;"><span>[http://mygitlab.com/]:
</span></span><span style="display:flex;"><span>Please enter the gitlab-ci token <span style="color:#fff;font-weight:bold">for</span> this runner:
</span></span><span style="display:flex;"><span>[M1jkqBfpuuzAnH9s7aYE]:
</span></span><span style="display:flex;"><span>Please enter the gitlab-ci description <span style="color:#fff;font-weight:bold">for</span> this runner:
</span></span><span style="display:flex;"><span>[server]:
</span></span><span style="display:flex;"><span>Please enter the gitlab-ci tags <span style="color:#fff;font-weight:bold">for</span> this runner (comma separated):
</span></span><span style="display:flex;"><span>implement
</span></span><span style="display:flex;"><span>Registering runner... succeeded                     runner=M1jkqBfp
</span></span><span style="display:flex;"><span>Please enter the executor: ssh, virtualbox, docker+machine, docker-ssh+machine, docker-ssh, parallels, kubernetes, docker, shell:
</span></span><span style="display:flex;"><span>shell
</span></span><span style="display:flex;"><span>Runner registered successfully. Feel free to start it, but <span style="color:#fff;font-weight:bold">if</span> it<span style="color:#f00">&#39;</span>s running already the config should be automatically reloaded!
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230109190131052.png" alt="image-20230109190131052"  />
</p>
<h4 id="dockerå®‰è£…">dockerå®‰è£…<a hidden class="anchor" aria-hidden="true" href="#dockerå®‰è£…">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºé…ç½®æ–‡ä»¶æŒ‚åœ¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ mkdir gitlab_runner_config
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯åŠ¨å®¹å™¨</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo docker run -d --name gitlab-runner --restart always     -v /var/run/docker.so^C:/var/run/docker.sock     -v /home/ljw/gitlab_runner_config/:/etc/gitlab-runner gitlab/gitlab-runner:latest
</span></span><span style="display:flex;"><span>[sudo] password <span style="color:#fff;font-weight:bold">for</span> ljw:
</span></span><span style="display:flex;"><span>Unable to find image <span style="color:#0ff;font-weight:bold">&#39;gitlab/gitlab-runner:latest&#39;</span> locally
</span></span><span style="display:flex;"><span>latest: Pulling from gitlab/gitlab-runner
</span></span><span style="display:flex;"><span>846c0b181fff: Pull <span style="color:#fff;font-weight:bold">complete</span>
</span></span><span style="display:flex;"><span>f05423af2dfd: Pull <span style="color:#fff;font-weight:bold">complete</span>
</span></span><span style="display:flex;"><span>d92eb7aeb475: Pull <span style="color:#fff;font-weight:bold">complete</span>
</span></span><span style="display:flex;"><span>Digest: sha256:15a3945030802e20d24326aef1e60b69478336842db88069303ddfdfe9cebf9a
</span></span><span style="display:flex;"><span>Status: Downloaded newer image <span style="color:#fff;font-weight:bold">for</span> gitlab/gitlab-runner:latest
</span></span><span style="display:flex;"><span>6125256c41ce4dc86f54aac997b50a633b94a0c94209740a3dc3be9e4e0983b7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo docker ps
</span></span><span style="display:flex;"><span>CONTAINER ID   IMAGE                         COMMAND                  CREATED          STATUS          PORTS     NAMES
</span></span><span style="display:flex;"><span>6125256c41ce   gitlab/gitlab-runner:latest   <span style="color:#0ff;font-weight:bold">&#34;/usr/bin/dumb-init â€¦&#34;</span>   <span style="color:#ff0;font-weight:bold">19</span> seconds ago   Up <span style="color:#ff0;font-weight:bold">17</span> seconds             gitlab-runner
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ–°å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œtest</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç•¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ³¨å†Œä¸€ä¸ªç‰¹å®šé¡¹ç›®runnerï¼Œä¸ºtest,ç¡®ä¿å®¹å™¨èƒ½è§£æåˆ°mygitlab.com</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo docker <span style="color:#fff;font-weight:bold">exec</span> -it gitlab-runner /bin/bash
</span></span><span style="display:flex;"><span>root@6125256c41ce:/# gitlab-runner register --url http://mygitlab.com/ --registration-token GR1348941sgKMG1cURqipSf8s7u7M
</span></span><span style="display:flex;"><span>Runtime platform                                    arch=amd64 os=linux pid=<span style="color:#ff0;font-weight:bold">56</span> revision=6d480948 version=15.7.1
</span></span><span style="display:flex;"><span>Running in system-mode.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Enter the GitLab instance URL (<span style="color:#fff;font-weight:bold">for</span> example, https://gitlab.com/):
</span></span><span style="display:flex;"><span>[http://mygitlab.com/]:
</span></span><span style="display:flex;"><span>Enter the registration token:
</span></span><span style="display:flex;"><span>[GR1348941sgKMG1cURqipSf8s7u7M]:
</span></span><span style="display:flex;"><span>Enter a description <span style="color:#fff;font-weight:bold">for</span> the runner:
</span></span><span style="display:flex;"><span>[6125256c41ce]:
</span></span><span style="display:flex;"><span>Enter tags <span style="color:#fff;font-weight:bold">for</span> the runner (comma-separated):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Enter optional maintenance note <span style="color:#fff;font-weight:bold">for</span> the runner:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: Support <span style="color:#fff;font-weight:bold">for</span> registration tokens and runner parameters in the <span style="color:#0ff;font-weight:bold">&#39;register&#39;</span> <span style="color:#fff;font-weight:bold">command</span> has been deprecated in GitLab Runner 15.6 and will be replaced with support <span style="color:#fff;font-weight:bold">for</span> authentication tokens. For more information, see https://gitlab.com/gitlab-org/gitlab/-/issues/380872
</span></span><span style="display:flex;"><span>Registering runner... succeeded                     runner=GR1348941sgKMG1cU
</span></span><span style="display:flex;"><span>Enter an executor: kubernetes, custom, docker, parallels, shell, ssh, docker+machine, instance, docker-ssh, virtualbox, docker-ssh+machine:
</span></span><span style="display:flex;"><span>shell
</span></span><span style="display:flex;"><span>Runner registered successfully. Feel free to start it, but <span style="color:#fff;font-weight:bold">if</span> it<span style="color:#f00">&#39;</span>s running already the config should be automatically reloaded!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Configuration (with the authentication token) was saved in <span style="color:#0ff;font-weight:bold">&#34;/etc/gitlab-runner/config.toml&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230109194543239.png" alt="image-20230109194543239"  />
</p>
<h2 id="å››cicdæµæ°´çº¿">å››ã€CICDæµæ°´çº¿<a hidden class="anchor" aria-hidden="true" href="#å››cicdæµæ°´çº¿">#</a></h2>
<h3 id="1åŸºæœ¬ä½¿ç”¨">1.åŸºæœ¬ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#1åŸºæœ¬ä½¿ç”¨">#</a></h3>
<ul>
<li>åˆ›å»ºé¡¹ç›®test</li>
</ul>
<p>â€‹	<img loading="lazy" src="/images/gitlab/image-20230110101533710.png" alt="image-20230110101533710"  />
</p>
<ul>
<li>é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºæµæ°´çº¿æ–‡ä»¶.gitlab-ci.yml</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages:          <span style="color:#007f7f"># List of stages for jobs, and their order of execution</span>
</span></span><span style="display:flex;"><span>  - build
</span></span><span style="display:flex;"><span>  - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>  - deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build-job:       <span style="color:#007f7f"># This job runs in the build stage, which runs first.</span>
</span></span><span style="display:flex;"><span>  stage: build
</span></span><span style="display:flex;"><span>  script:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Compiling the code...&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Compile complete.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>unit-test-job:   <span style="color:#007f7f"># This job runs in the test stage.</span>
</span></span><span style="display:flex;"><span>  stage: <span style="color:#fff;font-weight:bold">test</span>    <span style="color:#007f7f"># It only starts when the job in the build stage completes successfully.</span>
</span></span><span style="display:flex;"><span>  script:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Running unit tests... This will take about 60 seconds.&#34;</span>
</span></span><span style="display:flex;"><span>    - sleep <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Code coverage is 90%&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lint-test-job:   <span style="color:#007f7f"># This job also runs in the test stage.</span>
</span></span><span style="display:flex;"><span>  stage: <span style="color:#fff;font-weight:bold">test</span>    <span style="color:#007f7f"># It can run at the same time as unit-test-job (in parallel).</span>
</span></span><span style="display:flex;"><span>  script:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Linting code... This will take about 10 seconds.&#34;</span>
</span></span><span style="display:flex;"><span>    - sleep <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;No lint issues found.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy-job:      <span style="color:#007f7f"># This job runs in the deploy stage.</span>
</span></span><span style="display:flex;"><span>  stage: deploy  <span style="color:#007f7f"># It only runs when *both* jobs in the test stage complete successfully.</span>
</span></span><span style="display:flex;"><span>  environment: production
</span></span><span style="display:flex;"><span>  script:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Deploying application...&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Application successfully deployed.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½ä¼šè§¦å‘æµæ°´çº¿</p>
<p><img loading="lazy" src="/images/gitlab/image-20230110102803181.png" alt="image-20230110102803181"  />
</p>
</li>
<li>
<p>å¯ç‚¹å‡»æŸä¸€æ¬¡æµæ°´çº¿æŸ¥çœ‹æ‰§è¡Œè¯¦æƒ…</p>
</li>
</ul>
<blockquote>
<p>pipelineæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸‰ä¸ªé˜¶æ®µï¼Œbuildï¼Œtestï¼Œdeployï¼Œå¯åˆ†åˆ«æŸ¥çœ‹</p>
</blockquote>
<p>â€‹	<img loading="lazy" src="/images/gitlab/image-20230110103049970.png" alt="image-20230110103049970"  />
</p>
<h3 id="2æµæ°´çº¿è¯­æ³•æ£€æµ‹">2.æµæ°´çº¿è¯­æ³•æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#2æµæ°´çº¿è¯­æ³•æ£€æµ‹">#</a></h3>
<ul>
<li>ä½¿ç”¨CI lint æ£€æŸ¥pipelineæ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œç„¶åå†ä¿®æ”¹ä»“åº“æ–‡ä»¶</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230110103902318.png" alt="image-20230110103902318"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230110103838136.png" alt="image-20230110103838136"  />
</p>
<h3 id="3pipelineè¯­æ³•">3.pipelineè¯­æ³•<a hidden class="anchor" aria-hidden="true" href="#3pipelineè¯­æ³•">#</a></h3>
<h4 id="å…³é”®å­—æ¦‚è§ˆ">å…³é”®å­—æ¦‚è§ˆ<a hidden class="anchor" aria-hidden="true" href="#å…³é”®å­—æ¦‚è§ˆ">#</a></h4>
<table>
<thead>
<tr>
<th>å…³é”®è¯</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>job</td>
<td>pipelineæ–‡ä»¶ä¸­ç”±å¤šä¸ªä½œä¸šç»„æˆï¼Œæ¯ä¸ªä½œä¸šå¿…é¡»æœ‰ä¸€ä¸ªscriptï¼Œåå­—å¿…é¡»å”¯ä¸€</td>
</tr>
<tr>
<td>script</td>
<td>æŒ‡å®šå…·ä½“çš„æ“ä½œï¼Œç°åœ¨æ˜¯shellè¯­å¥</td>
</tr>
<tr>
<td>before_script</td>
<td>ä½œä¸šè¿è¡Œä¹‹å‰è¦åšçš„æ“ä½œï¼Œå¦‚æœæ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªä½œä¸šéƒ½ä¼šæ‰§è¡Œ</td>
</tr>
<tr>
<td>after_script</td>
<td>ä½œä¸šè¿è¡Œä¹‹åè¦åšçš„æ“ä½œï¼Œå¦‚æœæ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªä½œä¸šéƒ½ä¼šæ‰§è¡Œ</td>
</tr>
<tr>
<td>stages</td>
<td>æ§åˆ¶stageçš„é¡ºåºï¼Œä¸€ä¸ªstageå¯èƒ½æ‰§è¡Œå¤šä¸ªä½œä¸š</td>
</tr>
<tr>
<td>stage</td>
<td>æŒ‡å®šå½“å‰æ˜¯å“ªä¸ªstageï¼Œä¸¤ä¸ªå…³é”®å­—ï¼š.preä¸ºç¬¬ä¸€ä¸ªè¿è¡Œï¼Œ.postä¸ºæœ€åè¿è¡Œ</td>
</tr>
<tr>
<td>variables</td>
<td>å®šä¹‰å˜é‡</td>
</tr>
<tr>
<td>tags</td>
<td>æŒ‡å®šrunner</td>
</tr>
<tr>
<td>allow_failure</td>
<td>å…è®¸å¤±è´¥ï¼Œé»˜è®¤å€¼ä¸ºfalse</td>
</tr>
<tr>
<td>when</td>
<td>æ§åˆ¶ä½œä¸šæ‰§è¡Œæ¡ä»¶</td>
</tr>
<tr>
<td>retry</td>
<td>é‡è¯•æ¬¡æ•°</td>
</tr>
<tr>
<td>timeout</td>
<td>è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td>parallel</td>
<td>å¹¶è¡Œä½œä¸šå®ä¾‹æ•°ï¼Œ2&lt;x&lt;50ï¼Œåˆ›å»ºnä¸ªè¿è¡ŒåŒä¸€ä½œä¸š</td>
</tr>
<tr>
<td>only</td>
<td>é™åˆ¶å“ªäº›åˆ†æ”¯å’Œtagä¼šè¢«jobæ‰§è¡Œ</td>
</tr>
<tr>
<td>except</td>
<td>é™åˆ¶å“ªäº›åˆ†æ”¯å’Œtagä¸ä¼šè¢«jobæ‰§è¡Œ</td>
</tr>
<tr>
<td>rules</td>
<td>æ„å»ºè§„åˆ™ï¼ŒæŒ‰é¡ºåºåŒ¹é…ä¸ºä½œä¸šæä¾›å±æ€§</td>
</tr>
<tr>
<td>workflow</td>
<td>é€‚ç”¨äºæ•´ä¸ªç®¡é“æ˜¯å¦åˆ›å»º</td>
</tr>
<tr>
<td>cache</td>
<td>å­˜å‚¨ç¼–è¯‘æ—¶æ‰€éœ€è¦çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼ŒæŒ‡å®šé¡¹ç›®ç©ºé—´ä¸­éœ€è¦åœ¨jobä¹‹é—´ç¼“å­˜çš„æ–‡ä»¶/ç›®å½•ï¼Œå¯å…¨å±€å®šä¹‰æˆ–å±€éƒ¨å®šä¹‰</td>
</tr>
<tr>
<td>artifacts</td>
<td>åˆ¶å“ï¼Œä½œä¸šæˆåŠŸæˆ–å¤±è´¥æ—¶é™„åŠ åˆ°ä½œä¸šçš„æ–‡ä»¶æˆ–ç›®å½•åˆ—è¡¨ï¼Œä½œä¸šå®Œæˆåå‘é€åˆ°gitlab&lt;br /</td>
</tr>
<tr>
<td>dependencies</td>
<td>ä½¿ç”¨åˆ¶å“</td>
</tr>
<tr>
<td>needs</td>
<td>é˜¶æ®µå¹¶è¡Œï¼Œé€‚ç”¨äºæ‰§è¡Œæ— åºçš„ä½œä¸š</td>
</tr>
<tr>
<td>include</td>
<td>å¼•ç”¨é…ç½®</td>
</tr>
<tr>
<td>extends</td>
<td>ç»§æ‰¿ä½œä¸šé…ç½®ï¼Œä»æ¨¡ç‰ˆä¸­ç»§æ‰¿ï¼Œæ–°å®šä¹‰çš„åˆ™ä¸ç»§æ‰¿ï¼Œå…¶ä»–çš„å…¨éƒ¨ç»§æ‰¿</td>
</tr>
<tr>
<td>trigger</td>
<td>è§¦å‘å™¨ï¼Œè§¦å‘åˆ«çš„ç®¡é“</td>
</tr>
<tr>
<td>image</td>
<td>æŒ‡å®šdocker excutorçš„é•œåƒ</td>
</tr>
<tr>
<td>services</td>
<td>ä¾èµ–é•œåƒæœåŠ¡</td>
</tr>
<tr>
<td>inherit</td>
<td>æ˜¯å¦ä½¿ç”¨å®šä¹‰çš„å…¨å±€å˜é‡</td>
</tr>
<tr>
<td>environment</td>
<td>æŒ‡å®šå‘å¸ƒç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<h4 id="åŸºæœ¬å…³é”®å­—ä½¿ç”¨">åŸºæœ¬å…³é”®å­—ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#åŸºæœ¬å…³é”®å­—ä½¿ç”¨">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹</span>
</span></span><span style="display:flex;"><span>before_script:    <span style="color:#007f7f"># æ‰§è¡Œå‰åŠ¨ä½œ</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is global before script&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - sleep <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploying&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>    stage: .post
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;clean environment&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ›´æ–°pipelineæ–‡ä»¶è§‚å¯Ÿæ‰§è¡Œç»“æœ</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230110113239589.png" alt="image-20230110113239589"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230110113403511.png" alt="image-20230110113403511"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230110113446526.png" alt="image-20230110113446526"  />
</p>
<h4 id="tagsallow_failurewhenretrytimeoutparallel">tagsã€allow_failureã€whenã€retryã€timeoutã€parallel<a hidden class="anchor" aria-hidden="true" href="#tagsallow_failurewhenretrytimeoutparallel">#</a></h4>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>tags</td>
<td>æŒ‡å®šrunner</td>
</tr>
<tr>
<td>allow_failure</td>
<td>å…è®¸å¤±è´¥ï¼Œé»˜è®¤å€¼ä¸ºfalse</td>
</tr>
<tr>
<td>when</td>
<td>æ§åˆ¶ä½œä¸šæ‰§è¡Œï¼›<br />on_success:å‰é¢é˜¶æ®µæˆåŠŸæ‰æ‰§è¡Œï¼Œ<br />on_failure:å‰é¢é˜¶æ®µå‡ºç°å¤±è´¥æ—¶æ‰§è¡Œ<br />always:æ€»æ˜¯æ‰§è¡Œ<br />manual:æ‰‹åŠ¨<br />delayed:å»¶è¿Ÿæ‰§è¡Œ</td>
</tr>
<tr>
<td>retry</td>
<td>é‡è¯•æ¬¡æ•°</td>
</tr>
<tr>
<td>timeout</td>
<td>è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td>parallel</td>
<td>å¹¶è¡Œä½œä¸šå®ä¾‹æ•°ï¼Œ2&lt;x&lt;50ï¼Œåˆ›å»ºnä¸ªè¿è¡ŒåŒä¸€ä½œä¸š</td>
</tr>
</tbody>
</table>
<ul>
<li>ç¼–å†™æµ‹è¯•æ¡ˆä¾‹</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - sleep <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>        - eho <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - eho <span style="color:#0ff;font-weight:bold">&#34;this is test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    tags: 
</span></span><span style="display:flex;"><span>        - implement
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploying&#34;</span>
</span></span><span style="display:flex;"><span>    timeout: <span style="color:#ff0;font-weight:bold">1</span> minute
</span></span><span style="display:flex;"><span>    when: on_failure
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>    stage: .post
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;clean environment&#34;</span>
</span></span><span style="display:flex;"><span>    parallel: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    when: on_failure
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œç»“æœï¼š
<ul>
<li>buildä¸‰æ¬¡éƒ½å¤±è´¥ä½†æ˜¯å¿½ç•¥ï¼Œ</li>
<li>testå¤±è´¥ï¼Œ</li>
<li>deployæŒ‡å®šshared runnerï¼Œ</li>
<li>deployå’Œcleanéƒ½æ˜¯on_failureæ‰§è¡Œï¼Œå› æ­¤ä¼šæ‰§è¡Œ</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230110195442471.png" alt="image-20230110195442471"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230110195539636.png" alt="image-20230110195539636"  />
</p>
<h4 id="onlyexceptrulesworkflow">only,except,rules,workflow<a hidden class="anchor" aria-hidden="true" href="#onlyexceptrulesworkflow">#</a></h4>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>only</td>
<td>é™åˆ¶å“ªäº›åˆ†æ”¯å’Œtagä¼šè¢«jobæ‰§è¡Œ</td>
</tr>
<tr>
<td>except</td>
<td>é™åˆ¶å“ªäº›åˆ†æ”¯å’Œtagä¸ä¼šè¢«jobæ‰§è¡Œ</td>
</tr>
<tr>
<td>rules</td>
<td>æ„å»ºè§„åˆ™ï¼ŒæŒ‰é¡ºåºåŒ¹é…ä¸ºä½œä¸šæä¾›å±æ€§<br />ifï¼ˆå¦‚æœæ¡ä»¶åŒ¹é…ï¼‰<br />changesï¼ˆå¦‚æœæ¡ä»¶å‘ç”Ÿæ”¹å˜ï¼‰<br />existsï¼ˆæŒ‡å®šæ–‡ä»¶å­˜åœ¨ï¼‰</td>
</tr>
<tr>
<td>workflow</td>
<td>é€‚ç”¨äºæ•´ä¸ªç®¡é“æ˜¯å¦åˆ›å»º</td>
</tr>
</tbody>
</table>
<ul>
<li>æ¡ˆä¾‹</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:           <span style="color:#007f7f"># a.comåˆ™åˆ›å»ºpipeline</span>
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - sleep <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:     <span style="color:#007f7f"># mainåˆ†æ”¯æ‰æ‰§è¡Œtest</span>
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>    only: 
</span></span><span style="display:flex;"><span>        - main
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>deploy:     <span style="color:#007f7f"># developåˆ†æ”¯ä¸æ‰§è¡Œè¿™ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    tags: 
</span></span><span style="display:flex;"><span>        - implement
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploying&#34;</span>
</span></span><span style="display:flex;"><span>    timeout: <span style="color:#ff0;font-weight:bold">1</span> minute
</span></span><span style="display:flex;"><span>    except:
</span></span><span style="display:flex;"><span>        - develop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>    stage: .post
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;clean environment&#34;</span>
</span></span><span style="display:flex;"><span>    parallel: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    rules:    <span style="color:#007f7f"># å­˜åœ¨jenkinsFileæ‰ä¼šæœ‰è¿™ä¸€é˜¶æ®µ</span>
</span></span><span style="display:flex;"><span>        - exists: 
</span></span><span style="display:flex;"><span>            - jenkinsFile
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ‰§è¡Œç»“æœ</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230112110535834.png" alt="image-20230112110535834"  />
</p>
<h4 id="cacheartifactsdependencies">cache,artifacts,dependencies<a hidden class="anchor" aria-hidden="true" href="#cacheartifactsdependencies">#</a></h4>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>cache</td>
<td>å­˜å‚¨ç¼–è¯‘æ—¶æ‰€éœ€è¦çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼ŒæŒ‡å®šé¡¹ç›®ç©ºé—´ä¸­éœ€è¦åœ¨jobä¹‹é—´ç¼“å­˜çš„æ–‡ä»¶/ç›®å½•ï¼Œå¯å…¨å±€å®šä¹‰æˆ–å±€éƒ¨å®šä¹‰<br />pathsï¼šæŒ‡å®šç¼“å­˜ç›®å½•/æ–‡ä»¶<br />key:æ ‡è¯†ç¼“å­˜<br />key:files:æ–‡ä»¶å˜åŒ–è‡ªåŠ¨åˆ›å»ºç¼“å­˜ï¼Œfilesæœ€å¤šæŒ‡å®šä¸¤ä¸ªæ–‡ä»¶<br />prefix:å…è®¸ç»™å®šprefixçš„å€¼ä¸æŒ‡å®šæ–‡ä»¶ç”Ÿæˆå¯†é’¥ç»„åˆ<br />policy:ç¼“å­˜ç­–ç•¥ï¼Œé»˜è®¤åœ¨å¼€å§‹æ—¶ä¸‹è½½æ–‡ä»¶ï¼Œåœ¨ç»“æŸæ—¶ä¸Šä¼ æ–‡ä»¶ï¼Œè®¾ç½®ä¸ºpullè·³è¿‡ä¸‹è½½æ­¥éª¤ï¼Œè®¾ç½®ä¸ºpushè·³è¿‡ä¸Šä¼ æ­¥éª¤</td>
</tr>
<tr>
<td>artifacts</td>
<td>åˆ¶å“ï¼Œä½œä¸šæˆåŠŸæˆ–å¤±è´¥æ—¶é™„åŠ åˆ°ä½œä¸šçš„æ–‡ä»¶æˆ–ç›®å½•åˆ—è¡¨ï¼Œä½œä¸šå®Œæˆåå‘é€åˆ°gitlab<br />pathsï¼šæ”¶é›†æ–‡ä»¶æˆ–è€…ç›®å½•<br />expose_as:å±•ç¤ºåœ¨uiçš„åç§°<br />name:åˆ¶å“åç§°,å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œå¦‚$CI_JOB_NAME<br />when:åˆ¶å“åˆ›å»ºæ¡ä»¶<br />expire_in:åˆ¶å“ä¿ç•™æ—¶é—´<br />reports:junit:å•å…ƒæµ‹è¯•æŠ¥å‘Š<br />reports:cobertura:è¦†ç›–ç‡</td>
</tr>
<tr>
<td>dependencies</td>
<td>ä½¿ç”¨åˆ¶å“</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>cacheé»˜è®¤ç¼“å­˜ç­–ç•¥</p>
<p><img loading="lazy" src="/images/gitlab/image-20230113103649401.png" alt="image-20230113103649401"  />
</p>
<ul>
<li>
<p>ç¼“å­˜æ¡ˆä¾‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>	<span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache:
</span></span><span style="display:flex;"><span>    paths:
</span></span><span style="display:flex;"><span>        - target/      <span style="color:#007f7f"># ç¼“å­˜targetç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>        - implement
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - implement
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#fff;font-weight:bold">test</span> &gt;&gt; target/a.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    only: 
</span></span><span style="display:flex;"><span>        - main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy: 
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploying&#34;</span>
</span></span><span style="display:flex;"><span>        - cat target/a.txt
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploy success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>    stage: .post
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;clean environment&#34;</span>
</span></span><span style="display:flex;"><span>    parallel: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>        - exists: 
</span></span><span style="display:flex;"><span>            - jenkinsFile
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ‰§è¡Œç»“æœåˆ†æ</p>
<ul>
<li>
<p>cacheé»˜è®¤å­˜æ”¾åœ¨å®¶ç›®å½•</p>
</li>
<li>
<p>buildé˜¶æ®µï¼šä¸‹è½½ä¸Šä¸€æ¬¡çš„ç¼“å­˜ï¼Œæ‰§è¡Œç»“æŸåç”Ÿæˆç¼“å­˜ï¼Œéƒ½å­˜åœ¨æœ¬åœ°å®¶ç›®å½•
<img loading="lazy" src="/images/gitlab/image-20230113134343022.png" alt="image-20230113134343022"  />
</p>
</li>
<li>
<p>testé˜¶æ®µï¼šæ£€å‡ºåˆ†æ”¯ï¼Œåˆ æ‰æœ¬åœ°çš„targetï¼ŒåŠ è½½ç¼“å­˜ï¼Œæ‰§è¡Œå®Œä¿å­˜ç¼“å­˜</p>
<p><img loading="lazy" src="/images/gitlab/image-20230113134536955.png" alt="image-20230113134536955"  />
</p>
</li>
<li>
<p>deployé˜¶æ®µï¼šå·²ç»ä¿å­˜çš„ä¸Šæ¬¡çš„ç¼“å­˜å¯ä»¥ç›´æ¥æŸ¥çœ‹å†…å®¹</p>
<p><img loading="lazy" src="/images/gitlab/image-20230113134735053.png" alt="image-20230113134735053"  />
</p>
</li>
</ul>
</li>
<li>
<p>åˆ¶å“æ¡ˆä¾‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>  
</span></span><span style="display:flex;"><span>    artifacts:
</span></span><span style="display:flex;"><span>        paths:
</span></span><span style="display:flex;"><span>            - target/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#fff;font-weight:bold">test</span> &gt;&gt; target/a.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    only: 
</span></span><span style="display:flex;"><span>        - main
</span></span><span style="display:flex;"><span>    artifacts:
</span></span><span style="display:flex;"><span>        paths:
</span></span><span style="display:flex;"><span>            - target/
</span></span><span style="display:flex;"><span>        expose_as: target_file
</span></span><span style="display:flex;"><span>        name: a.txt
</span></span><span style="display:flex;"><span>        when: on_success
</span></span><span style="display:flex;"><span>    dependencies:
</span></span><span style="display:flex;"><span>        - build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy: 
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    dependencies:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploying&#34;</span>
</span></span><span style="display:flex;"><span>        - cat target/a.txt
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;deploy success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>    stage: .post
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;clean environment&#34;</span>
</span></span><span style="display:flex;"><span>    parallel: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>        - exists: 
</span></span><span style="display:flex;"><span>            - jenkinsFile
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>åœ¨jobä¸­å¯ä»¥çœ‹åˆ°ä¸Šä¼ åˆ¶å“ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥æµè§ˆä¸‹è½½</p>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230114100625209.png" alt="image-20230114100625209"  />
</p>
<h4 id="needs">needs<a hidden class="anchor" aria-hidden="true" href="#needs">#</a></h4>
<ul>
<li>é˜¶æ®µå¹¶è¡Œï¼Œé€‚ç”¨äºæ‰§è¡Œæ— åºçš„ä½œä¸š</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åŸå§‹æ•ˆæœï¼ŒABä¸¤ä¸ªbuildéƒ½ç»“æŸæ‰å¯ä»¥æ‰§è¡ŒABä¸¤ä¸ªtest</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># needså®ç°Aæ‰§è¡Œå®Œå°±å¯ä»¥æ‰§è¡ŒAçš„testï¼ŒèŠ‚çœæ—¶é—´</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>    - clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>        - sleep <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>  
</span></span><span style="display:flex;"><span>    artifacts:
</span></span><span style="display:flex;"><span>        paths:
</span></span><span style="display:flex;"><span>            - target/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build B:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>        - sleep <span style="color:#ff0;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>    after_script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;this is after build script&#34;</span>
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    retry: <span style="color:#ff0;font-weight:bold">2</span>  
</span></span><span style="display:flex;"><span>    artifacts:
</span></span><span style="display:flex;"><span>        paths:
</span></span><span style="display:flex;"><span>            - target/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">test</span> A:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#fff;font-weight:bold">test</span> &gt;&gt; target/a.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    only: 
</span></span><span style="display:flex;"><span>        - main
</span></span><span style="display:flex;"><span>    needs:
</span></span><span style="display:flex;"><span>        - job: build A
</span></span><span style="display:flex;"><span>          artifacts: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">test</span> B:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#fff;font-weight:bold">test</span> &gt;&gt; target/a.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    only: 
</span></span><span style="display:flex;"><span>        - main
</span></span><span style="display:flex;"><span>    needs:
</span></span><span style="display:flex;"><span>        - job: build B
</span></span><span style="display:flex;"><span>          artifacts: <span style="color:#fff;font-weight:bold">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>includeå¼•ç”¨</p>
<ul>
<li>localï¼šå¼•ç”¨åŒä¸€å­˜å‚¨åº“ä¸­çš„æ–‡ä»¶ï¼Œä½¿ç”¨ç›¸å¯¹äºæ ¹ç›®å½•çš„å®Œæ•´è·¯å¾„è¿›è¡Œå¼•ç”¨</li>
<li>file:å¼•ç”¨å…¶ä»–é¡¹ç›®é…ç½®</li>
<li>templateï¼šå¼•ç”¨å®˜æ–¹æ¨¡ç‰ˆ</li>
<li>remoteï¼šè¿œç¨‹æ–‡ä»¶åœ°å€</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºCIæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾å¼•ç”¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ci/local.yml
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span>  deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># local: ci/local.yml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># remote è¦èƒ½è·å–åˆ°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># remote: &#39;http://mygitlab.com/gitlab-instance-77485aca/test/-/raw/main/ci/local.yml&#39;</span>
</span></span><span style="display:flex;"><span>    - project: <span style="color:#0ff;font-weight:bold">&#39;gitlab-instance-77485aca/test&#39;</span>
</span></span><span style="display:flex;"><span>      file: ci/local.yml
</span></span><span style="display:flex;"><span>      ref: main
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># template: Auto-DevOps.gitlab-ci.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">test</span> A:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230114110536452.png" alt="image-20230114110536452"  />
</p>
</li>
<li>
<p>extendsï¼šç»§æ‰¿ä½œä¸šé…ç½®ï¼Œä»æ¨¡ç‰ˆä¸­ç»§æ‰¿ï¼Œæ–°å®šä¹‰çš„åˆ™ä¸ç»§æ‰¿ï¼Œå…¶ä»–çš„å…¨éƒ¨ç»§æ‰¿</p>
</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æ¡ˆä¾‹ï¼šä½¿ç”¨extendsç»§æ‰¿äº†å±æ€§ï¼Œtesté˜¶æ®µç›´æ¥è¢«è·³è¿‡ï¼Œå› ä¸ºå‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå¤±è´¥æ‰ä¼šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>workflow:
</span></span><span style="display:flex;"><span>    rules:
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">if</span>: $Domain == <span style="color:#0ff;font-weight:bold">&#34;a.com&#34;</span>
</span></span><span style="display:flex;"><span>      when: always
</span></span><span style="display:flex;"><span>    - when: never 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>common:
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - ehco this is script
</span></span><span style="display:flex;"><span>    when: on_failure
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - ls
</span></span><span style="display:flex;"><span>        - id
</span></span><span style="display:flex;"><span>        - mkdir target
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">test</span> A:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    extends: common
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;run test </span>$Version<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230114152457229.png" alt="image-20230114152457229"  />
</p>
<ul>
<li>
<p>triggerï¼šè§¦å‘å™¨</p>
<ul>
<li>ä»triggerå®šä¹‰åˆ›å»ºçš„ä½œä¸šå¯åŠ¨æ—¶å°†åˆ›å»ºä¸€ä¸ªä¸‹æ¸¸ç®¡é“</li>
<li>å…è®¸åˆ›å»ºå¤šé¡¹ç›®ç®¡é“å’Œå­ç®¡é“</li>
<li>triggerä¸whenï¼šmanualä¸€èµ·æ—¶ä¼šå‡ºé”™</li>
<li>å¤šé¡¹ç›®ç®¡é“ï¼šä¸€ä¸ªé¡¹ç›®ä¸­çš„ç®¡é“å¯ä»¥è§¦å‘å…¶ä»–é¡¹ç›®ä¸­çš„ç®¡é“ï¼ˆå¾®æœåŠ¡æ¶æ„ï¼‰</li>
<li>çˆ¶å­ç®¡é“ï¼šåœ¨é¡¹ç›®ä¸­è§¦å‘ä¸€ç»„åŒæ—¶è¿è¡Œçš„ç®¡é“ï¼Œä¸å—çˆ¶ç®¡é“è¿›åº¦é™åˆ¶</li>
<li>å¤šé¡¹ç›®ç®¡é“å®ä¾‹</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºé¡¹ç›®test2å¹¶è®¾ç½®pipeline</span>
</span></span><span style="display:flex;"><span>stages:
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;test2 deploying&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨testä¸­ä½¿ç”¨triggerè§¦å‘test2çš„ç®¡é“</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    trigger:
</span></span><span style="display:flex;"><span>        project: gitlab-instance-77485aca/test2
</span></span><span style="display:flex;"><span>        branch: main
</span></span><span style="display:flex;"><span>        strategy: depend
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230114160319770.png" alt="image-20230114160319770"  />
</p>
<ul>
<li>çˆ¶å­é¡¹ç›®ç®¡é“å®ä¾‹</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–å†™æ¡ˆä¾‹    </span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    trigger:
</span></span><span style="display:flex;"><span>        include: ci/local.yml   <span style="color:#007f7f"># åˆ›å»ºå­ç®¡é“</span>
</span></span><span style="display:flex;"><span>        strategy: depend   <span style="color:#007f7f"># å­ç®¡é“æ‰§è¡Œå®Œçˆ¶ç®¡é“æ‰ç®—æ‰§è¡Œç»“æŸï¼Œç»§ç»­ä¸‹é¢çš„æ‰§è¡Œ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230114155407347.png" alt="image-20230114155407347"  />
</p>
</li>
</ul>
<h4 id="imageservices">image/services<a hidden class="anchor" aria-hidden="true" href="#imageservices">#</a></h4>
<ul>
<li>imageï¼šdockeræ‰§è¡Œå™¨éœ€è¦åˆ¶å®šé•œåƒï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼Œjobä¸­æŒ‡å®šé•œåƒä¼˜å…ˆçº§é«˜äºrunneré•œåƒ</li>
<li>service:ä¾èµ–æœåŠ¡ï¼Œåé¢æ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºdockeræ‰§è¡Œå™¨ï¼ŒæŒ‡å®šé•œåƒä¸ºalpine:latest</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥,å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ä¸»æœºåè§£æï¼Œè¦ç¡®ä¿å®¹å™¨ä¹Ÿèƒ½è®¿é—®åˆ°gitlabï¼Œå› æ­¤æˆ‘å°†å®¿ä¸»æœºçš„hostsæ–‡ä»¶æŒ‚åœ¨è¿›å®¹å™¨</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ sudo grep  -C2 pull_policy /etc/gitlab-runner/config.toml
</span></span><span style="display:flex;"><span>    [runners.cache.azure]
</span></span><span style="display:flex;"><span>  [runners.docker]
</span></span><span style="display:flex;"><span>    pull_policy = <span style="color:#0ff;font-weight:bold">&#34;if-not-present&#34;</span>
</span></span><span style="display:flex;"><span>    tls_verify = <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>    image = <span style="color:#0ff;font-weight:bold">&#34;alpine:latest&#34;</span>
</span></span><span style="display:flex;"><span>    volumes = [<span style="color:#0ff;font-weight:bold">&#34;/etc/hosts:/etc/hosts:rw&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;/cache&#34;</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºæµ‹è¯•pipeline</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:
</span></span><span style="display:flex;"><span>		- name: redis:latest
</span></span><span style="display:flex;"><span>		  alias: myredis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - docker
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230115183844630.png" alt="image-20230115183844630"  />
</p>
<h4 id="environment">environment<a hidden class="anchor" aria-hidden="true" href="#environment">#</a></h4>
<ul>
<li>æŒ‡å®šä½œä¸šå‘å¸ƒï¼Œæ–¹ä¾¿uiç»Ÿä¸€ç®¡ç†ç¯å¢ƒçš„å‘å¸ƒè®°å½•ä»¥åŠé‡æ–°å‘å¸ƒç­‰</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>variables:  <span style="color:#007f7f"># å˜é‡å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    Version: <span style="color:#0ff;font-weight:bold">&#34;16.2&#34;</span>
</span></span><span style="display:flex;"><span>    Domain: a.com
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>stages: <span style="color:#007f7f"># å®šä¹‰é˜¶æ®µè¿è¡Œé¡ºåº</span>
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build A:  <span style="color:#007f7f"># jobåå­—ä¸ºbuild</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - docker
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;start build&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;build success&#34;</span>
</span></span><span style="display:flex;"><span>    environment:
</span></span><span style="display:flex;"><span>          name: production   <span style="color:#007f7f"># æŒ‡æ˜ç”Ÿäº§ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>          url: http:www.baidu.com  <span style="color:#007f7f"># ä¸ºç”Ÿäº§ç¯å¢ƒæŒ‡å®šä¸€ä¸ªurl</span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230115185136132.png" alt="image-20230115185136132"  />
				<img loading="lazy" src="/images/gitlab/image-20230115185224515.png" alt="image-20230115185224515"  />
</p>
<h4 id="inherit">inherit<a hidden class="anchor" aria-hidden="true" href="#inherit">#</a></h4>
<ul>
<li>æ˜¯å¦ä½¿ç”¨å®šä¹‰çš„å…¨å±€å˜é‡</li>
</ul>
<h3 id="4æ¨¡ç‰ˆåº“è§„åˆ’">4.æ¨¡ç‰ˆåº“è§„åˆ’<a hidden class="anchor" aria-hidden="true" href="#4æ¨¡ç‰ˆåº“è§„åˆ’">#</a></h3>
<ul>
<li>1.åˆ›å»ºä¸€ä¸ªgitä»“åº“ciå­˜æ”¾æ¨¡ç‰ˆ</li>
<li>2.templatesç›®å½•å­˜æ”¾pipelineæ¨¡ç‰ˆ</li>
<li>3.jobsç›®å½•å­˜æ”¾jobæ¨¡ç‰ˆ</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230116202540946.png" alt="image-20230116202540946"  />
</p>
<h2 id="äº”å·¥å…·é“¾ç»§æ‰¿">äº”ã€å·¥å…·é“¾ç»§æ‰¿<a hidden class="anchor" aria-hidden="true" href="#äº”å·¥å…·é“¾ç»§æ‰¿">#</a></h2>
<h3 id="1mavené›†æˆ">1.Mavené›†æˆ<a hidden class="anchor" aria-hidden="true" href="#1mavené›†æˆ">#</a></h3>
<ul>
<li>å®‰è£…mavenç¯å¢ƒï¼Œmavenæ˜¯javaé¡¹ç›®çš„æ„å»ºæ‰“åŒ…å·¥å…·</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># å®‰è£…ä¸ç”¨å¤šè¯´</span>
</span></span><span style="display:flex;"><span>ljw@server:~$ mvn -v
</span></span><span style="display:flex;"><span>Apache Maven 3.6.3
</span></span><span style="display:flex;"><span>Maven home: /usr/share/maven
</span></span><span style="display:flex;"><span>Java version: 1.8.0_341, vendor: Oracle Corporation, runtime: /home/ljw/tools/jdk1.8.0_341/jre
</span></span><span style="display:flex;"><span>Default locale: en_US, platform encoding: UTF-8
</span></span><span style="display:flex;"><span>OS name: <span style="color:#0ff;font-weight:bold">&#34;linux&#34;</span>, version: <span style="color:#0ff;font-weight:bold">&#34;5.4.0-136-generic&#34;</span>, arch: <span style="color:#0ff;font-weight:bold">&#34;amd64&#34;</span>, family: <span style="color:#0ff;font-weight:bold">&#34;unix&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åˆ›å»ºbuildä½œä¸šæ¨¡ç‰ˆ</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># jobsç›®å½•ä¸‹æ–°å»ºbuild.yml</span>
</span></span><span style="display:flex;"><span>.build:   <span style="color:#007f7f"># åŠ .ä½œä¸ºæ¨¡ç‰ˆä¸ºä¸‹é¢ç»§æ‰¿</span>
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - $build_shell
</span></span><span style="display:flex;"><span>        - ls
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åˆ›å»ºpipelineæ¨¡ç‰ˆ</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨templatesç›®å½•ä¸‹æ–°å»ºjava-common.yml</span>
</span></span><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>    project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/build.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:
</span></span><span style="display:flex;"><span>    build_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn clean package -DskipTests&#39;</span>
</span></span><span style="display:flex;"><span>    cache_dir: target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache:
</span></span><span style="display:flex;"><span>    paths:
</span></span><span style="display:flex;"><span>        - $cache_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    extends: .build
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ç›´æ¥import giteeä¸­çš„jtimeré¡¹ç›®</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¢åŠ pipelineæ–‡ä»¶</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/gitlab/image-20230116211558251.png" alt="image-20230116211558251"  />
</p>
<ul>
<li>è¿›è¡Œæ‰©å±•ï¼Œåœ¨jobsåŠ å…¥test.yml</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>.test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - $test_shell
</span></span><span style="display:flex;"><span>    artifacts:
</span></span><span style="display:flex;"><span>        paths: 
</span></span><span style="display:flex;"><span>            - $result
</span></span><span style="display:flex;"><span>        reports:
</span></span><span style="display:flex;"><span>            junit: target/surefire-reports/TEST-*.yml
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å°†teståŠ åˆ°javaçš„pipelineæ¨¡ç‰ˆä¸­</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/build.yml
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/test.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:
</span></span><span style="display:flex;"><span>    build_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn clean package -DskipTests&#39;</span>
</span></span><span style="display:flex;"><span>    test_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn test &#39;</span>
</span></span><span style="display:flex;"><span>    cache_dir: target
</span></span><span style="display:flex;"><span>    result: target/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache:
</span></span><span style="display:flex;"><span>    paths:
</span></span><span style="display:flex;"><span>        - $cache_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages:
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    extends: .build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    extends: .test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ›´å¤šçš„é˜¶æ®µéƒ½ç±»ä¼¼</li>
</ul>
<h3 id="2npmé›†æˆ">2.Npmé›†æˆ<a hidden class="anchor" aria-hidden="true" href="#2npmé›†æˆ">#</a></h3>
<ul>
<li>
<p>åˆ›å»ºä¸€ä¸ªnpmé¡¹ç›®,ç›´æ¥æ‰¾ä¸€ä¸ªå¼€æºé¡¹ç›®importï¼Œæˆ‘ä½¿ç”¨è‹¥ä¾çš„å‰ç«¯â€˜</p>
</li>
<li>
<p>åœ¨cié¡¹ç›®templateç›®å½•ä¸‹åˆ›å»ºnpm-common.ymlç”¨ä½œnpmæ¨¡ç‰ˆæ–‡ä»¶</p>
</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/build.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages:
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:
</span></span><span style="display:flex;"><span>    build_shell: <span style="color:#0ff;font-weight:bold">&#34;npm run build:prod&#34;</span>   <span style="color:#007f7f"># package.jsonä¸­å®šä¹‰äº†æ„å»ºè„šæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    before_script:
</span></span><span style="display:flex;"><span>        - npm install    <span style="color:#007f7f"># npmé¡¹ç›®éœ€è¦å®‰è£…ä¾èµ–</span>
</span></span><span style="display:flex;"><span>    extends: .build
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨é¡¹ç›®ä¸‹æ–°å»ºpipelineæ–‡ä»¶</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: templates/npm-common.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image:
</span></span><span style="display:flex;"><span>  name: node:16
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ„å»ºæˆåŠŸ</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230124184931180.png" alt="image-20230124184931180"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230124185006271.png" alt="image-20230124185006271"  />
</p>
<ul>
<li>éœ€è¦å…¶ä»–æ“ä½œå†è¿›è¡Œæ‰©å±•å³å¯</li>
</ul>
<h3 id="3é›†æˆåˆ¶å“åº“">3.é›†æˆåˆ¶å“åº“<a hidden class="anchor" aria-hidden="true" href="#3é›†æˆåˆ¶å“åº“">#</a></h3>
<ul>
<li>ç›´æ¥ä½¿ç”¨dockerå®‰è£…artifactoryè¿›è¡Œé›†æˆ</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo docker pull releases-docker.jfrog.io/jfrog/artifactory-oss:latest
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å‚è€ƒhttps://www.jfrog.com/confluence/display/JFROG/Installing+Artifactory#114759846aa77ee5734e34d7b8d6fba728e7f646f   è¿›è¡Œå®‰è£…</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>artifactoryæ˜¯ä¸€ä¸ªåˆ¶å“ä»“åº“ï¼Œåˆ›å»ºä¸€ä¸ªcidevopsçš„ä»“åº“</p>
</li>
<li>
<p><img loading="lazy" src="/images/gitlab/image-20230126183824244.png" alt="image-20230126183824244"  />
ä½¿ç”¨è´¦å·å¯†ç /apikey/accesskeyç­‰æ–¹å¼å¯ä»¥è¿›è¡Œæ¥å£æ“ä½œï¼Œä¸‹é¢æ¼”ç¤ºä½¿ç”¨è´¦å·å¯†ç è¿›è¡Œåˆ¶å“çš„ä¸Šä¼ </p>
</li>
</ul>
<blockquote>
<p>ä¸Šä¼ æ—¶å¯ä½¿ç”¨å¤šçº§ç›®å½•è®°å½•åˆ¶å“çš„åº”ç”¨ï¼Œç‰ˆæœ¬ï¼Œåˆ†æ”¯ï¼Œç­‰ç­‰ä¿¡æ¯</p>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨jobsä¸­åŠ å…¥ä¸Šä¼ åˆ¶å“çš„æ­¥éª¤ï¼Œæ­¤æ—¶jobsç›®å½•ä¸‹æ–°å»ºupload.ymlå†…å®¹ä¸º</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.deploy_artifact:
</span></span><span style="display:flex;"><span>    stage: upload
</span></span><span style="display:flex;"><span>    tags: 
</span></span><span style="display:flex;"><span>        - build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - curl -u$ArtifactoryUser:$ArtifactoryPass -X PUT <span style="color:#0ff;font-weight:bold">&#34;</span>$ArtifactoryUrl<span style="color:#0ff;font-weight:bold">/</span>$ArtifactoryName<span style="color:#0ff;font-weight:bold">/</span>$TargetFilePath<span style="color:#0ff;font-weight:bold">/</span>$TargetFileName<span style="color:#0ff;font-weight:bold">&#34;</span> -T $ArtifactoryPath
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯¹äºä¸€äº›éšç§æ•°æ®å¯ä»¥åœ¨é¡¹ç›®-&gt;è®¾ç½®-&gt;CICDä¸­è®¾ç½®å˜é‡,è¿™é‡Œè®¾ç½®Artifactoryçš„è´¦å·å¯†ç </li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230126101918908.png" alt="image-20230126101918908"  />
</p>
<ul>
<li>åœ¨javaçš„æ¨¡ç‰ˆä¸­åŠ å…¥ä¸Šä¼ åˆ¶å“æ­¥éª¤</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/build.yml
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/test.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/upload.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:
</span></span><span style="display:flex;"><span>    build_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn clean package -DskipTests&#39;</span>
</span></span><span style="display:flex;"><span>    test_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn test &#39;</span>
</span></span><span style="display:flex;"><span>    cache_dir: target
</span></span><span style="display:flex;"><span>    result: target
</span></span><span style="display:flex;"><span>    ArtifactoryPath: target/*.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># ä¸Šä¼ åˆ¶å“åº“</span>
</span></span><span style="display:flex;"><span>    ArtifactoryUrl: http://192.168.0.14:8081/artifactory
</span></span><span style="display:flex;"><span>    ArtifactoryName: cidevops
</span></span><span style="display:flex;"><span>    TargetFilePath: <span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAMESPACE<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAME<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_REF_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_SHA<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_PIPELINE_NAME<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    TargetFileName: <span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_REF_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_SHA<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_PIPELINE_NAME<span style="color:#0ff;font-weight:bold">}</span>.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache:
</span></span><span style="display:flex;"><span>    paths:
</span></span><span style="display:flex;"><span>        - $cache_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - upload
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    extends: .build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    extends: .test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy_artifact:
</span></span><span style="display:flex;"><span>    stage: upload
</span></span><span style="display:flex;"><span>    extends: .deploy_artifact
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åˆ¶å“ä¸Šä¼ æˆåŠŸï¼Œç›®å½•ç»“æ„ä¸ºç»„/é¡¹ç›®/åˆ†æ”¯ç­‰ä¿¡æ¯</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230126194746619.png" alt="image-20230126194746619"  />
</p>
<ul>
<li>
<p>downloadå¯ä»¥æ–°å»ºjob</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># down_artifact.yml</span>
</span></span><span style="display:flex;"><span>.down_artifact:
</span></span><span style="display:flex;"><span>    stage: deploy
</span></span><span style="display:flex;"><span>    tags:
</span></span><span style="display:flex;"><span>        - build
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - curl -u{ArtifactoryUser}:<span style="color:#0ff;font-weight:bold">${</span>ArtifactoryPass<span style="color:#0ff;font-weight:bold">}</span> -O <span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">${</span>ArtifactoryUrl<span style="color:#0ff;font-weight:bold">}${</span>ArtifactoryName<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">/</span><span style="color:#0ff;font-weight:bold">${</span>TargetFilePath<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">/</span><span style="color:#0ff;font-weight:bold">${</span>TargetFileName<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="4é•œåƒä»“åº“é›†æˆ">4.é•œåƒä»“åº“é›†æˆ<a hidden class="anchor" aria-hidden="true" href="#4é•œåƒä»“åº“é›†æˆ">#</a></h3>
<ul>
<li>é€šè¿‡DockerFileè¿›è¡Œæ‰“åŒ…æ„å»ºï¼Œå†é€šè¿‡æ¥å£ä¸Šä¼ åˆ°é•œåƒä»“åº“</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æºä»£ç ä¸­ä¸Šä¼ DockerFile</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨upload.ymlä¸­</span>
</span></span><span style="display:flex;"><span>.docker-build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    tags: 
</span></span><span style="display:flex;"><span>        - docker-build  <span style="color:#007f7f"># runnerä¸Šå¿…é¡»æœ‰dockerï¼Œæœ€å¥½ç”¨shell executor</span>
</span></span><span style="display:flex;"><span>    script:
</span></span><span style="display:flex;"><span>        - docker login -u <span style="color:#0ff;font-weight:bold">${</span>CI_REGISTRY_USER<span style="color:#0ff;font-weight:bold">}</span> -p <span style="color:#0ff;font-weight:bold">${</span>CI_REGISTRY_PASS<span style="color:#0ff;font-weight:bold">}</span> <span style="color:#0ff;font-weight:bold">${</span>CI_REGISTRY<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        - dodcker build -t <span style="color:#0ff;font-weight:bold">${</span>IMAGE_NAME<span style="color:#0ff;font-weight:bold">}</span> -f <span style="color:#0ff;font-weight:bold">${</span>DOCKERFILE_PATH<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        - docker push <span style="color:#0ff;font-weight:bold">${</span>IMAGE_NAME<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        - docker rmi <span style="color:#0ff;font-weight:bold">${</span>IMAGE_NAME<span style="color:#0ff;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ­¤æ—¶çš„java-common.yml</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>include:
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/build.yml
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/test.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/down_artifact.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - project: devops/ci
</span></span><span style="display:flex;"><span>    ref: main
</span></span><span style="display:flex;"><span>    file: jobs/upload.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variables:
</span></span><span style="display:flex;"><span>    build_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn clean package -DskipTests&#39;</span>
</span></span><span style="display:flex;"><span>    test_shell: <span style="color:#0ff;font-weight:bold">&#39;mvn test &#39;</span>
</span></span><span style="display:flex;"><span>    cache_dir: target
</span></span><span style="display:flex;"><span>    result: target
</span></span><span style="display:flex;"><span>    ArtifactoryPath: target/*.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># ä¸Šä¼ åˆ¶å“åº“</span>
</span></span><span style="display:flex;"><span>    ArtifactoryUrl: http://192.168.0.14:8081/artifactory
</span></span><span style="display:flex;"><span>    ArtifactoryName: cidevops
</span></span><span style="display:flex;"><span>    TargetFilePath: <span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAMESPACE<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAME<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_REF_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_SHA<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_PIPELINE_NAME<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    TargetFileName: <span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_REF_NAME<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_COMMIT_SHA<span style="color:#0ff;font-weight:bold">}</span>-<span style="color:#0ff;font-weight:bold">${</span>CI_PIPELINE_NAME<span style="color:#0ff;font-weight:bold">}</span>.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># dockeré…ç½®</span>
</span></span><span style="display:flex;"><span>    DOCKERFILE_PATH: <span style="color:#0ff;font-weight:bold">&#34;./Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span>    CI_REGISTRY: ccr.ccs.tencentyun.com
</span></span><span style="display:flex;"><span>    REGISTRY_PATH: idevops
</span></span><span style="display:flex;"><span>    CI_REGISTRY_USER: <span style="color:#ff0;font-weight:bold">100018599267</span> 
</span></span><span style="display:flex;"><span>    CI_REGISTRY_PASS: ljw00000
</span></span><span style="display:flex;"><span>    VERSION: 1.0. <span style="color:#007f7f"># è¿™é‡Œåªæ˜¯å®éªŒï¼Œå¯ä»¥ä½¿ç”¨å˜é‡</span>
</span></span><span style="display:flex;"><span>    IMAGE_NAME: <span style="color:#0ff;font-weight:bold">${</span>CI_REGISTRY<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>REGISTRY_PATH<span style="color:#0ff;font-weight:bold">}</span>/<span style="color:#0ff;font-weight:bold">${</span>CI_PROJECT_NAME<span style="color:#0ff;font-weight:bold">}</span>:<span style="color:#0ff;font-weight:bold">${</span>VERSION<span style="color:#0ff;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cache:
</span></span><span style="display:flex;"><span>    paths:
</span></span><span style="display:flex;"><span>        - $cache_dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stages:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - build
</span></span><span style="display:flex;"><span>    - <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    - upload
</span></span><span style="display:flex;"><span>    - down
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>    stage: build
</span></span><span style="display:flex;"><span>    extends: .build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test:
</span></span><span style="display:flex;"><span>    stage: <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>    extends: .test
</span></span><span style="display:flex;"><span>    allow_failure: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>down:
</span></span><span style="display:flex;"><span>    stage: down
</span></span><span style="display:flex;"><span>    extends: .down_artifact
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>deploy_artifact:
</span></span><span style="display:flex;"><span>    stage: upload
</span></span><span style="display:flex;"><span>    extends: .deploy_artifact
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upload_docker:
</span></span><span style="display:flex;"><span>    stage: upload
</span></span><span style="display:flex;"><span>    extends: .docker-build
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ­¤å¤„ä½¿ç”¨è…¾è®¯äº‘ä¸ªäººé•œåƒä»“åº“</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230127101802588.png" alt="image-20230127101802588"  />
</p>
<ul>
<li>ç®€å•ç¼–å†™Dockerfile</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>FROM openjdk:8-alpine
</span></span><span style="display:flex;"><span>ADD target/*.jar /app.jar
</span></span><span style="display:flex;"><span>ENTRYPOINT [<span style="color:#0ff;font-weight:bold">&#34;java&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;-jar&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;/app.jar&#34;</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è®¾ç½®åˆ†å¸ƒå¼ç¼“å­˜ï¼Œç›®å‰é˜¶æ®µéƒ½æ˜¯dockeræ‰§è¡Œå™¨ï¼Œdocker buildåœ¨shellæ‰§è¡Œå™¨æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯å¤šä¸ªrunneréœ€è¦è®¾ç½®åˆ†å¸ƒå¼ç¼“å­˜,æˆ‘ä½¿ç”¨ä¸ƒç‰›äº‘çš„å¯¹è±¡å­˜å‚¨ï¼Œæ”¯æŒs3æ¥å£</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># /etc/gitlab-runner/config.tomlç¼“å­˜éƒ¨åˆ†é…ç½®</span>
</span></span><span style="display:flex;"><span>[runners.cache]
</span></span><span style="display:flex;"><span>    Type = <span style="color:#0ff;font-weight:bold">&#34;s3&#34;</span>
</span></span><span style="display:flex;"><span>    Path = <span style="color:#0ff;font-weight:bold">&#34;gitlab-ci-cache&#34;</span>
</span></span><span style="display:flex;"><span>    Shared = <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    MaxUploadedArchiveSize = <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    [runners.cache.s3]
</span></span><span style="display:flex;"><span>      ServerAddress = <span style="color:#0ff;font-weight:bold">&#34;s3-cn-east-1.qiniucs.com&#34;</span> <span style="color:#007f7f"># åœ°å€</span>
</span></span><span style="display:flex;"><span>      AccessKey = <span style="color:#0ff;font-weight:bold">&#34;x x x x&#34;</span>
</span></span><span style="display:flex;"><span>      SecretKey = <span style="color:#0ff;font-weight:bold">&#34;xxxxx&#34;</span>
</span></span><span style="display:flex;"><span>      BucketName = <span style="color:#0ff;font-weight:bold">&#34;ljw-devops&#34;</span>
</span></span><span style="display:flex;"><span>      Insecure = <span style="color:#fff;font-weight:bold">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æµ‹è¯•pipeline</li>
</ul>
<p><img loading="lazy" src="/images/gitlab/image-20230127170322537.png" alt="image-20230127170322537"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230127170342079.png" alt="image-20230127170342079"  />
</p>
<p><img loading="lazy" src="/images/gitlab/image-20230127170412259.png" alt="image-20230127170412259"  />
</p>
<h3 id="5jmeterè‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ">5.jmeterè‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ<a hidden class="anchor" aria-hidden="true" href="#5jmeterè‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ">#</a></h3>
<ul>
<li>ä½¿ç”¨ant+jmeterè‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>å¼€å¯gitlab pagesåŠŸèƒ½æ”¶é›†æµ‹è¯•æŠ¥å‘Šè¿›è¡Œå±•ç¤º</li>
<li>åœ¨é¡¹ç›®ç»“æŸé›†æˆåè§¦å‘è¿™ä¸ªä¸‹æ¸¸é¡¹ç›®è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•</li>
</ul>
<blockquote>
<p>â€‹	è¿™å—ä¸ç†Ÿï¼Œä¸ä¼šå†™æµ‹è¯•æ–‡ä»¶ï¼Œåç»­è¡¥å……</p>
</blockquote>
<h3 id="6sonarqubeä»£ç æ‰«æé›†æˆ">6.SonarQubeä»£ç æ‰«æé›†æˆ<a hidden class="anchor" aria-hidden="true" href="#6sonarqubeä»£ç æ‰«æé›†æˆ">#</a></h3>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jary-287.github.io/cloudnative.github.io/tags/cicd/">CICD</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://jary-287.github.io/cloudnative.github.io/posts/think/demo/">
    <span class="title">Next Â»</span>
    <br>
    <span>è¿™æ˜¯ä¸€ä¸ªdemoæ–‡ç« </span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://jary-287.github.io/cloudnative.github.io">Javen&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
